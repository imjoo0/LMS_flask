{% extends 'index.html' %}
{% block title %}
선생님 업무 관리 페이지
{% endblock %}

{% block topnav %}
{% if user %}
{{ user['name'] }} ({{ user['engname'] }})님 환영합니다.
{% else %}
로그인이 필요합니다.
{% endif %}
{% endblock %}
{% block style %}
<link rel="stylesheet" href="../static/style/teacher.css">
{% endblock %}
{% with messages = get_flashed_messages() %}
    {% if messages %}
    <script> alert("{{ messages[-1] }}")</script>
    {% endif %}
{% endwith %}
{% block content %}
{% autoescape off %}
<!-- 문의 남기기 -->
<div class="modal fade" id="question" tabindex="-1"
    aria-labelledby="questionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="questionModalLabel">
                    본원에 문의 남기기
                </h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div>
            <form action="/teacher/question" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" style="display: block;"/>
                <ul>
                    <li>문의 종류 : 
                        <select id="question_kind" class="border rounded-0 form-control form-control-sm" name="question_category" style=" width: 150px; height: 100%;" onchange="change_question_kind(this.value)">
                            <optgroup>
                                <option value="none" selected>문의 종류를 선택해주세요</option>
                                <option value="일반">일반 문의</option>
                                <option value="이반">이반 승인 요청</option>
                                <option value="퇴소">퇴소 승인 요청</option>
                                <option value="취소/환불">취소/환불 승인 요청</option>
                            </optgroup>
                        </select>
                    </li>
                    <div id="invisible_for_2">
                        <li>기존 반 : 
                            <select class="border rounded-0 form-control form-control-sm" name="ban_id" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>기존 반을 선택해주세요</option>
                                    {% for ban in my_bans %}
                                    {% set ban_registerno = ban['register_no'] %}
                                    <option value={{ban_registerno}}>{{ban['name']}}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </li>
                        <li>대상학생 :
                            <select id="student_list" class="border rounded-0 form-control form-control-sm" name="target_student" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>대상학생을 선택해주세요</option>
                                    {% for student in students %}
                                    {% set student_registerno = student['register_no'] %}
                                    <option value={{student_registerno}}>{{ student['name'] }}({{ student['origin']}})</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </li>
                        <li>상담내용 : 
                            <select class="border rounded-0 form-control form-control-sm" name="consulting_history" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>상담을 우선 진행해주세요</option>
                                    <option value=0>for student</option>
                                </optgroup>
                            </select>
                        </li>
                        <li>이반 요청 반 : 
                            <select class="border rounded-0 form-control form-control-sm" name="new_ban_id" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>이반 하려는 반을 선택해주세요</option>
                                    {% for ban in all_ban %}
                                    {% set ban_registerno = ban['register_no'] %}
                                    <option value={{ban_registerno}}>{{ ban['name'] }} ({{ ban['semester'] }}학기)</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </li>
                    </div>
                    <div id="invisible_for_1">
                        <li>반 : 
                            <select class="border rounded-0 form-control form-control-sm" name="o_ban_id" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>퇴소하려는 반을 선택해주세요</option>
                                    {% for ban in my_bans %}
                                    {% set ban_registerno = ban['register_no'] %}
                                    <option value={{ban_registerno}}>{{ ban['name'] }}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </li>
                        <li>대상학생 :
                            <select id="student_list" class="border rounded-0 form-control form-control-sm" name="o_target_student" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>학생을 선택해주세요</option>
                                    {% for student in students %}
                                    {% set student_registerno = student['register_no'] %}
                                    <option value={{student.register_no}}>{{ student['name'] }}({{ student['origin'] }})</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </li>
                        <li>상담내용 : 
                            <select class="border rounded-0 form-control form-control-sm" name="o_consulting_history" style=" width: 150px; height: 100%;">
                                <optgroup>
                                    <option value="none" selected>진행한 상담의 상담일지를 선택해주세요</option>
                                    <option value=0>for student</option>
                                </optgroup>
                            </select>
                        </li>
                    </div>
                    <div id="question_box">
                        <li><label>문의 제목</label>
                            <input type="text" size="50"
                                name="question_title">
                        </li>
                        <li><label>문의 내용</label>
                            <textarea
                                class="border rounded-0 form-control form-control-sm"
                                type="text"rows="5" cols="25" 
                                name="question_contents"
                                id = "question_contents"></textarea>
                        </li>
                    </div>
                </ul>
                <div style="display: flex; float: right;">
                    <button class="btn btn-success" type="submit" style="margin-top: 13px;">저장</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" style="margin-top: 13px;">취소</button>
                </div>
            </form>
            </div>
                        
        </div>
    </div>
</div>
<!-- 문의 조회 -->
<div class="modal fade" id="question_list" tabindex="-1"
    aria-labelledby="questionListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="questionListModalLabel">
                    문의 답변 확인 
                </h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div id="questiondetail" style="width:100%;">
                <button type="button" class="btn btn-back" onclick="go_back()">다른 문의조회🔙 </button>
                <div id="questiondetail_box" style="width:100%;"></div>
            </div>
            <table class="table text-center" id="questionlist" style="width:100%;">
                <tbody  style="width:100%;">
                    <tr class="row">
                        <th class="col-3">종류</th>
                        <th class="col-5">제목</th>
                        <th class="col-2">답변</th>
                        <th class="col-2">수정/삭제</th>
                    </tr>
                    {% if questions is iterable %}
                        {% for question in questions %}
                        <tr class="row">
                            {% if question.category == 0 %}
                            <td class="col-3">일반문의</td>
                            {% elif question.category == 1 %}
                            <td class="col-3">퇴소문의</td>
                            {% elif question.category == 2 %}
                            <td class="col-3">이반문의</td>
                            {% else %}
                            <td class="col-3">취소/환불</td>
                            {% endif %}
                            <td class="col-5">{{ question.title }} </td>
                            {% if question.answer_id == None %}
                            <td class="col-2"> 미응답 </td>
                            {% else %}
                            <td class="col-2"  onclick="get_answer('{{question.id}}')">  ✔️  </td>
                            {% endif %}
                            <td class="col-2"  onclick="get_answer('{{question.id}}')"> ✏️❌ </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr class="row">
                            {% if questions.category == 0 %}
                            <td class="col-3">일반문의</td>
                            {% elif questions.category == 1 %}
                            <td class="col-3">퇴소문의</td>
                            {% elif questions.category == 2 %}
                            <td class="col-3">이반문의</td>
                            {% else %}
                            <td class="col-3">취소/환불</td>
                            {% endif %}
                            <td class="col-7">{{ questions.title }} </td>
                            {% if questions.answer_id == null %}
                            <td class="col-2"> 미답변 </td>
                            {% else %}
                            <td class="col-2"  onclick="get_answer('{{questions.id}}')"> ✔️ </td>
                            {% endif %}
                        </tr>
                    {% endif %}
                </tbody>
            </table>    
        </div>
    </div>
</div>

<div class="container_box">
    <section id="user-info">
        <div class="d-flex justify-content-center flex-row">
            <div class="col-lg-6 d-flex justify-content-center flex-row">
                <!-- <button onclick="edit_personal_info()">정보 수정</button> -->
                <div class="question-btn-container">
                    <div class="question-btn head-office-question-btn" data-bs-toggle="modal" data-bs-target="#question"><img src="https://purpleacademy.net/free_project/public/image/head-office-question-btn.png"></div>  
                    <p class="question-label">본원 문의</p>
                </div>
                <div class="question-btn-container">
                    <div class="question-btn answer-a-question" data-bs-toggle="modal" data-bs-target="#question_list"><img src="https://purpleacademy.net/free_project/public/image/answer-a-question.png"></div>
                    <p class="question-label">문의 답변</p>
                </div>
                <div class="question-btn-container">
                  <div class="question-btn show-last-counsulting"><img src="https://purpleacademy.net/free_project/public/image/show-last-counsulting.png"></div>
                  <p class="question-label">지난 상담 조회</p>
                </div>                        
            </div>
            <div class="col-lg-6 d-flex align-items-center flex-column">
                <div class="user-detail">
                    <div class="user-detail-deco"></div>
                    <div class="user-name">
                        <img src="https://purpleacademy.net/free_project/public/image/teacher-profile.png">
                        <span>{{ user['name'] }}({{ user['engname'] }}) 선생님 안녕하세요.</span>
                    </div>
                    <div class="user-contact">
                        <div>
                            <i class="fa-solid fa-mobile-screen-button"></i>
                            <span>&nbsp;&nbsp;{{ user['email'] }}</span>
                        </div>
                        <div class="mt-3">
                            <i class="fa-regular fa-envelope"></i>
                            <span>&nbsp;&nbsp;{{ user['mobileno'] }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <table border="0">
                <th>선생님 개인 정보</th>
                <th></th>
                <th></th>
                <tr>
                    <td>{{ user['name'] }}({{ user['engname'] }})</td>
                    <td>{{ user['mobileno'] }} / </td>
                    <td>{{ user['email'] }}</td>
                </tr>
            </table> -->
            
        </div>
    </section>
    <div class="d-flex justify-content-center flex-row">
    <section id="statistics">
        <div class="total_info">
            <div class="total_chart">
                <div class="chartWrap">
                    <div class="chart">
                        <div class="chart-total">
                            <span class="chart-total-num">Total:<br></span>
                        </div>
                    </div>
                    <div class="chart-bar" data-deg="50"></div>
                    <div class="chart-bar" data-deg="95"></div>
                    <div class="chart-bar" data-deg="150"></div>
                    <div class="chart-bar" data-deg="295/360*100">
                    </div>
                </div>
            </div>
            <div class="total_table">
                <table class="table text-center" id="unlearned">
                    <tbody  style="width:100%;">
                        <tr class="row">
                            <th class="col-3">IXL</th>
                            <th class="col-3">리딩</th>
                            <th class="col-3">리특</th>
                            <th class="col-3">라이팅</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3"> 임시3 (5%) </td>
                            <td class="col-3"> 임시3 (5%) </td>
                            <td class="col-3"> 임시3 (5%) </td>
                            <td class="col-3"> 임시3 (5%) </td>
                        </tr>
                    </tbody>
                </table>
                <table class="table text-center" id="unlearned">
                    <tbody  style="width:100%;">
                        <tr class="row">
                            <th class="col-6">업무</th>
                            <th class="col-6">상담</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3"> 임시3/10 </td>
                            <td class="col-3"> 5% </td>
                            <td class="col-3"> 임시3/10 </td>
                            <td class="col-3"> 5% </td>
                        </tr>
                    </tbody>
                </table>  
                <table class="table text-center" id="unlearned">
                    <tbody  style="width:100%;">
                        <tr class="row">
                            <th class="col-6">공지</th>
                            <th class="col-6">문의</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3"> 임시3/10 </td>
                            <td class="col-3"> 5% </td>
                            <td class="col-3"> 임시3/10 </td>
                            <td class="col-3"> 5% </td>
                        </tr>
                    </tbody>
                </table>      
            </div>
        </div>
        
        <div class="class_info">
            <table class="table text-center" id="class_list" style="width:100%;">
                <tbody  style="width:100%;">
                    <tr class="row">
                        <th class="col-2">반이름</th>
                        <th class="col-1">학기</th>
                        <th class="col-1">원생 수</th>
                        <th class="col-2">퇴소</th>
                        <th class="col-2">이반</th>
                        <th class="col-2">미학습</th>
                        <th class="col-2">문의 미응답</th>
                    </tr>
                    {% for ban in my_bans %}
                    <tr class="row">
                        <td class="col-2">{{ ban['name'] }}</td>
                        <td class="col-1">{{ ban['name_numeric'] }}</td>
                        <td class="col-1">{{ ban['total_student_num '] }}</td>
                        <td class="col-2"> 임시3 (5%) </td>
                        <td class="col-2"> 임시3 (5%) </td>
                        <td class="col-2"> 임시3 (5%) </td>
                        <td class="col-2"> 임시3 (5%) </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>    
        </div>
    
    </section>
    
    <section id="work">
        <div class="label make_row"style="margin-top: 5px;" >
            <h3>상담 * 업무</h3>
            <select id="work_done" class="border rounded-0 form-control form-control-sm" name="work_done" style=" width: 200px; height: 100%; text-align: center; margin-left: auto;" onchange="task_doneview(this.value)">
                <optgroup>
                    <option value=0>미완수</option>
                    <option value=1>완수</option>
                </optgroup>
            </select>
        </div>
        <div class="container border rounded-3 p-4 pb-1">
            {% for category in my_task_category %}
            <details>
                <summary onclick="get_task('{{category}}')"><strong>{{ all_task_category[category-1].name }} 업무 </strong></summary>
                    <div class="make_col" id="task_contents_box{{category}}">
                        <div class="make_row" id="task_ban_box_incomplete{{category}}">
                        </div>
                        <div class="make_row" id="task_ban_box_complete{{category}}">
                        </div>
                    </div>
                </div>
            </details>
            {% endfor %}
        </div>
    </section>
    </div>
</div>

{% block jspart %}
<script type="text/javascript" src="../static/js/teacher.js"></script>
<script type="text/javascript" src="../static/js/chart.js"></script>
{% endblock %}

{% endautoescape %}
{% endblock %}
