{% extends 'index.html' %}
{% block title %}
ê´€ë¦¬ë¶€ì„œ í˜ì´ì§€
{% endblock %}

{% block topnav %}
{% if user %}
ê´€ë¦¬ë¶€ì„œë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.
{% else %}
ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endif %}
{% endblock %}
{% block style %}
<link rel="stylesheet" href="../static/style/manage.css">
<link rel="stylesheet" href="../static/style/paginate.css">
{% endblock %}
<script>
    function getBanInfo(b_id){
    console.log(b_id)
    $('#label_title').empty();
    $('#profile_data').empty();
    $('#ban_data').empty();
    $('#s_data').empty();
    $('#ban_statistics').empty();
    $('#target_a_student').empty();
    if( b_id == 'none'){
        $('#default_title').show();
        $('#student_data').hide();
        $('#pagingul').hide();
    }else{
        $('#default_title').hide();
        $('#student_data').show();
        $('#pagingul').show();
    }
    if( b_id == 'ì „ì²´ ë°˜'){
        $('#default_title').show();
        $('#student_data').hide();
        $('#pagingul').hide();
        $('#select_student').hide();
        $('#target_bans').empty();
    }else{
        $('#select_student').show();
    }
    $.ajax({
        type: "GET",
        url: "/manage/ban/"+b_id,
        data: {},
        success: function (response) {
            let target_ban = get_ban(b_id)
            let ban_name = target_ban['ban_name'];
            let semester = target_ban['semester'];
            let teacher_name = target_ban['teacher_name']
            let teacher_e_name = target_ban['teacher_engname']
            let teacher_mobileno = target_ban['teacher_mobileno']
            let teacher_email = target_ban['teacher_email']
            console.log(target_ban)
            let temp_title = `<h1>${semester}í•™ê¸° ${ban_name} í˜„í™©</h1>`
            $('#label_title').append(temp_title);

            let temp_profile_data = `
            <table border="0">
                <th>ë‹´ì„ ì„ ìƒë‹˜ ì •ë³´</th>
                <th></th>
                <th></th>
                <tr>
                    <td>${teacher_name}(${teacher_e_name})</td>
                    <td> ğŸ“ ${teacher_mobileno} </td>
                    <td> âœ‰ï¸ ${teacher_email}</td>
                </tr>
            </table>
            `;
            $('#profile_data').append(temp_profile_data);

            let students_num = target_ban['student_num']
            let temp_ban_data = `
            <table class="table text-center" style="width:100%;">
                <tbody  style="width:100%;">
                    <tr class="row">
                        <th class="col-2">ì´ ì›ìƒ ìˆ˜</th>
                        <th class="col-2">ì´ë°˜</th>
                        <th class="col-2">í‡´ì†Œ</th>
                        <th class="col-3">ì·¨ì†Œ/í™˜ë¶ˆ</th>
                        <th class="col-3">ë¯¸í•™ìŠµ</th>
                    </tr>
                    <tr class="row">
                        <td class="col-2">${students_num}</td>
                        <td class="col-2"> ì„ì‹œ3 (5%) </td>
                        <td class="col-2"> ì„ì‹œ3 (5%) </td>
                        <td class="col-3"> ì„ì‹œ3 (5%) </td>
                        <td class="col-3"> ì„ì‹œ3 (5%) </td>
                    </tr>
                </tbody>
            </table>
            `;
            $('#ban_data').append(temp_ban_data);

            data_list = get_students(b_id)
            console.log(data_list)
            totalData = students_num

            displayData(totalData, 1, 3,data_list);
            paging(totalData, 3, pageCount, 1,data_list);

            let temp_ban_statistics = `
            <table class="table text-center" id="unlearned" style="margin-left:1%; margin-right: 4%;width: 40%;">
                    <tbody  style="width:100%;">
                        <tr class="row" style="background: #DCE6F2;">
                            <th class="col-12">ë¯¸í•™ìŠµ ê´€ë¦¬</th>
                        </tr>
                        <tr class="row">
                            <th class="col-3">IXL</th>
                            <th class="col-3">ë¦¬ë”©</th>
                            <th class="col-3">ë¦¬íŠ¹</th>
                            <th class="col-3">ë¼ì´íŒ…</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3"> ì„ì‹œ3 (5%) </td>
                            <td class="col-3"> ì„ì‹œ3 (5%) </td>
                            <td class="col-3"> ì„ì‹œ3 (5%) </td>
                            <td class="col-3"> ì„ì‹œ3 (5%) </td>
                        </tr>
                    </tbody>
                </table>
                <table class="table text-center" id="teaching" style="margin-right: 4%; width: 25%;">
                    <tbody  style="width:100%;">
                        <tr class="row" style="background: #DCE6F2;">
                            <th class="col-12">ìƒë‹´*ì—…ë¬´ ê´€ë¦¬</th>
                        </tr>
                        <tr class="row">
                            <th class="col-6">ì—…ë¬´</th>
                            <th class="col-6">ìƒë‹´</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3"> 3/10 </td>
                            <td class="col-3"> 5% </td>
                            <td class="col-3"> 3/10 </td>
                            <td class="col-3"> 5% </td>
                        </tr>
                    </tbody>
                </table>  
                <table class="table text-center" id="task"style="width: 25%;" >
                    <tbody  style="width:100%;">
                        <tr class="row" style="background: #DCE6F2;">
                            <th class="col-12">ê³µì§€*ë¬¸ì˜ ê´€ë¦¬</th>
                        </tr>
                        <tr class="row">
                            <th class="col-6">ê³µì§€</th>
                            <th class="col-6">ë¬¸ì˜</th>
                        </tr>
                        <tr class="row">
                            <td class="col-3">3/10 </td>
                            <td class="col-3"> 5% </td>
                            <td class="col-3">3/10 </td>
                            <td class="col-3"> 5% </td>
                        </tr>
                    </tbody>
                </table>      
            `;

            $('#ban_statistics').append(temp_ban_statistics);

            // ìƒë‹´ìš”ì²­ì‹œ ë·° ë°”ê¿”ì£¼ëŠ” ë¶€ë¶„ 
            let temp_target_ban = `
            <p> ì„ íƒ - ${ban_name} <a></p>
            `;
            $('#target_bans').html(temp_target_ban);

            // ì „ì²´ í•™ìƒ ëŒ€ìƒ ì§„í–‰ append 
            let target_all_student = `<option value="ì „ì²´í•™ìƒ">âœ”ï¸ ${ban_name}ë°˜ ì „ì²´ í•™ìƒ ëŒ€ìƒ ì§„í–‰</option>`;
            $('#target_a_student').append(target_all_student)
            
            $('#target_student').empty();
            for (var i = 0; i < totalData; i++) {
                target = JSON.parse(data_list[i])
                let id = target.id
                let name = target.name;
                let original = target.original;
                let temp_target_student = `<option value="${id}"> ${name} ( ${original} )</option>`;
                $('#target_student').append(temp_target_student)
            } 
        }
    })
}
</script>
{% block content %}
{% autoescape off %}
<!-- ìƒë‹´ ìš”ì²­ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì°½ -->
<div class="modal fade" id="my_consulting_request" tabindex="-1" aria-labelledby="questionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="questionModalLabel">
                    ìš”ì²­í•œ ìƒë‹´ ëª©ë¡ 
                </h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div>
                <table class="table text-center" id="consulting_task_list" style="width:100%;">
                    <tbody  style="width:100%;">
                        <thead>
                            <tr class="row">
                                <th class="col-3">ë‚ ì§œ</th>
                                <th class="col-2">ì¢…ë¥˜</th>
                                <th class="col-1">ì§„í–‰</th>
                                <th class="col-4">ë‚´ìš©</th>
                                <th class="col-2">ìˆ˜ì •/ì‚­ì œ</th>
                            </tr>
                        </thead>
                       
                        {% for consulting in consultings %}
                        <tr class="row">
                            <td class="col-3">{{ consulting.startdate }} ~ {{ consulting.deadline }}</td>
                            {% if consulting.category_id == 1 %}
                            <td class="col-2">ì •ê¸°ìƒë‹´</td>
                            {% elif consulting.category_id == 2 %}
                            <td class="col-2">6ê°œì›”ìƒë‹´</td>
                            {% else %}
                            <td class="col-2">ê·€ì°®ìƒë‹´</td>
                            {% endif %}
                            <td class="col-1"> ë¯¸ì§„í–‰ </td>
                            <td class="col-4"> {{ consulting.contents }} </td>
                            <td class="col-2"> <button>âœï¸</button> <button>âŒ</button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table> 
            </div>

        </div>
    </div>
</div>

<!-- ìƒë‹´ìš”ì²­ ëª¨ë‹¬ -->
<div class="modal fade" id="request_consulting" tabindex="-1" aria-labelledby="RequestConsultingModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="RequestConsultingModalLabel">
                    ìƒë‹´ ìš”ì²­
                </h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding-top: 0;">
                <form action="/manage/ban" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" style="display: block;" />
                    <div class="make_row">
                        <select class="border rounded-0 form-control form-control-sm" name="consulting_category"
                            style=" width: 150px; height: 100%; margin-left:0;">
                            <optgroup label="ìƒë‹´ì¹´í…Œê³ ë¦¬ ì„ íƒ">
                                {% for category in consulting_category %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </optgroup>
                        </select>
                        <input class="border rounded-0 form-control form-control-sm" type="text"
                            name="consulting_contents" placeholder="ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    </div>
                    <div class="notice_message">
                        <p>ğŸ‘‡ ìƒë‹´ì„ ì§„í–‰í•  ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                        <div class="plus_under_contents">
                            <select class="border rounded-0 form-control form-control-sm" name="consulting_target_ban"
                                id="consulting_target_ban" onchange="getBanInfo(this.value)">
                                <optgroup label="ìƒë‹´ ì§„í–‰ ë°˜ ì„ íƒ">
                                    <option value="ì „ì²´ ë°˜">âœ”ï¸ ì „ì²´ ë°˜ ëŒ€ìƒ ì§„í–‰ ( ì €ì¥ í´ë¦­ í›„ 5ë¶„ ì†Œìš” ë©ë‹ˆë‹¤ ) </option>
                                    {% for ban in all_ban %}
                                    {% set ban_regi = ban['register_no'] %}
                                    <option value="{{ban_regi}}">{{ ban['name'] }}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                            <div class="make_row" id="target_bans">

                            </div>
                        </div>
                        <div class="notice_message" id="select_student">
                            <p>ğŸ‘‡ ìƒë‹´ì„ ì§„í–‰í•  í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                            <select class="border rounded-0 form-control form-control-sm"
                                name="consulting_target_student" id="consulting_target_student">
                                <optgroup id="target_a_student" label="ë°˜ ëŒ€ìƒ ì „ì²´ ì§„í–‰">

                                </optgroup>
                                <optgroup id="target_student" label="ê°œë³„ í•™ìƒ ëŒ€ìƒ ì§„í–‰">

                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="notice_message">
                        <p>ğŸ‘‡ ìƒë‹´ì„ ì‹œì‘í•´ì•¼ í•˜ëŠ” ë‚ ì§œë¥¼ 2022-01-01 í˜•ì‹ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”</p>
                        <input class="border rounded-0 form-control form-control-sm" type="text" name="consulting_date"
                            placeholder="2023-01-01">
                    </div>

                    <div class="notice_message">
                        <p>ğŸ‘‡ ìƒë‹´ì„ ëë‚´ì•¼ í•˜ëŠ” ë§ˆê° ë‚ ì§œë¥¼ 2022-01-01 í˜•ì‹ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”</p>
                        <input class="border rounded-0 form-control form-control-sm" type="text"
                            name="consulting_deadline" placeholder="2023-01-01">
                    </div>
                    <div style="display: flex; float: right;">
                        <button class="btn btn-success" type="submit" style="margin-top: 13px;">ì €ì¥</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                            style="margin-top: 13px;">ì·¨ì†Œ</button>
                    </div>

                </form>

            </div>


        </div>
    </div>
</div>


<!-- ì—…ë¬´ìš”ì²­ ëª¨ë‹¬ -->
<div class="modal fade" id="request_task" tabindex="-1" aria-labelledby="RequestTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="RequestTaskModalLabel">
                    ì—…ë¬´ ìš”ì²­
                </h5>
                <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding-top: 0;">
                <form action="/manage/task" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" style="display: block;" />
                    <div class="make_row">
                        <select class="border rounded-0 form-control form-control-sm" name="task_category"
                            style=" width: 200px; height: 100%; margin-left:0;">
                            <optgroup label="ì—…ë¬´ì¹´í…Œê³ ë¦¬ ì„ íƒ">
                                <option value="none" selected>ì—…ë¬´ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                {% for category in task_category %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </optgroup>
                        </select>
                        <input class="border rounded-0 form-control form-control-sm" type="text" name="task_contents"
                            placeholder="ì—…ë¬´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    </div>
                    <div class="notice_message">
                        <p>ğŸ‘‡ ì—…ë¬´ë¥¼ ì§„í–‰í•  ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                        <div class="plus_under_contents">
                            <select class="border rounded-0 form-control form-control-sm" name="task_target_ban" id="task_target_ban" onchange="getBanInfo(this.value)">
                                <optgroup label="ì—…ë¬´ ì§„í–‰ ë°˜ ì„ íƒ">
                                    <option value="none" selected>ì§„í–‰ ë°˜ ì„ íƒ</option>
                                    <option value="ì „ì²´ ë°˜">âœ”ï¸ ì „ì²´ ëŒ€ìƒ ì§„í–‰ ( ì €ì¥ í´ë¦­ í›„ ì¡°ê¸ˆ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” ) </option>
                                    {% for bt in ban_teacher %}
                                    <option value="{{ bt['ban'] }}">{{ bt['ban_name'] }} | ë‹´ë‹¹ ì„ ìƒë‹˜: {{ bt['teacher_name']
                                        }}</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                            <div class="make_row" id="target_bans">

                            </div>
                        </div>
                    </div>

                    <div class="notice_message">
                        <p>ğŸ‘‡ ì—…ë¬´ì„ ì‹œì‘í•´ì•¼ í•˜ëŠ” ë‚ ì§œë¥¼ 2022-01-01 í˜•ì‹ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”</p>
                        <input class="border rounded-0 form-control form-control-sm" type="text" name="task_date"
                            placeholder="2023-01-01">
                    </div>

                    <div class="notice_message">
                        <p>ğŸ‘‡ ì—…ë¬´ì„ ëë‚´ì•¼ í•˜ëŠ” ë§ˆê° ë‚ ì§œë¥¼ 2022-01-01 í˜•ì‹ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”</p>
                        <input class="border rounded-0 form-control form-control-sm" type="text" name="task_deadline"
                            placeholder="2023-01-01">
                    </div>
                    <div class="notice_message">
                        <p>ğŸ‘‡ ì—…ë¬´ ì°¸ê³  url ì„ ì•Œë ¤ì£¼ì„¸ìš” (ì—†ì„ ê²½ìš°: ì—†ìŒ)</p>
                        <input class="border rounded-0 form-control form-control-sm" type="text" name="task_url"
                            placeholder="https://www.purpleacademy.co.kr/">
                    </div>
                    <div class="notice_message">
                        <p style="margin-right: 6px;"> ì—…ë¬´ ì£¼ê¸°ì™€ ì—…ë¬´ ìš°ì„ ìˆœìœ„ì„¤ì • : </p>
                        <div class="make_row">
                            <select class="border rounded-0 form-control form-control-sm" name="task_cycle"
                            style=" width: 200px; height: 100%; margin-left:0;">
                                <optgroup>
                                    <option value="none" selected>ì—…ë¬´ ì£¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                    <option value=1>ì›”ìš”ì¼ ì—…ë¬´</option>
                                    <option value=2>í™”ìš”ì¼ ì—…ë¬´</option>
                                    <option value=3>ìˆ˜ìš”ì¼ ì—…ë¬´</option>
                                    <option value=4>ëª©ìš”ì¼ ì—…ë¬´</option>
                                    <option value=5>ê¸ˆìš”ì¼ ì—…ë¬´</option>
                                    <option value=6>ìƒì‹œ ì—…ë¬´</option>
                                    <option value=7>ì—…ë¬´ ì£¼ê¸° ì—†ìŒ</option>
                                </optgroup>
                            </select>
                            <select class="border rounded-0 form-control form-control-sm" name="task_priority"
                                style=" width: 200px; height: 100%; margin-left:0;">
                                <optgroup>
                                    <option value="none" selected>ì—…ë¬´ ìš°ì„ ìˆœìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                    <option value=4>ìµœìš°ì„  ì—…ë¬´</option>
                                    <option value=3>ì˜¤ì „ ì—…ë¬´</option>
                                    <option value=2>ì˜¤í›„ ì—…ë¬´</option>
                                    <option value=1>ìš°ì„ ìˆœìœ„ ë¬´ê´€</option>
                                </optgroup>
                            </select>
                        
                        </div>
                    </div>

                    <div style="display: flex; float: right;">
                        <button class="btn btn-success" type="submit" style="margin-top: 13px;">ì €ì¥</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                            style="margin-top: 13px;">ì·¨ì†Œ</button>
                    </div>

                </form>

            </div>


        </div>
    </div>
</div>

<div class="container_box">
    <section id="statistics">
        <div class="make_row">
            <div class="label" id="default_title">
                <h1> ë°˜ í˜„í™© ê²€ìƒ‰ </h1>
            </div>
            <div class="label" id="label_title">

            </div>
            <select name="target_ban" onchange="getBanInfo(this.value)">
                <optgroup>
                    <option value="none" selected>ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    {% for ban in all_ban %}
                    {% set ban_regi = ban['register_no']  %}
                    <option value={{ban_regi}}>{{ban['name']}} ({{ban['semester']}})</option>
                    {% endfor %}
                </optgroup>
            </select>
        </div>
        <div class="make_col">
            <div id="profile_data">

            </div>
            <div id="ban_data">

            </div>
            <table class="table text-center" style="width:100%;" id="student_data">
                <tr class="row" style="background: #DCE6F2;">
                    <th class="col-12" id="displayCount"></th>
                </tr>
                <tr class="row" style="background:#DCE6F2;">
                    <th class="col-2">ì›ìƒ ì •ë³´</th>
                    <th class="col-4">ì—°ë½ì²˜</th>
                    <th class="col-3">ë¶€ëª¨ë‹˜ ì •ë³´</th>
                    <th class="col-2">ë¯¸í•™ìŠµ</th>
                    <th class="col-1">ìƒì„¸</th>
                </tr>
                <tr id="s_data" class="row">

                </tr>
            </table>
            <ul id="pagingul"></ul>

            <div id="ban_statistics" class="make_row">

            </div>

            <div class="make_row" id="request_box">
                    <button class="custom-control custom-control-inline custom-checkbox" data-bs-toggle="modal"
                    data-bs-target="#request_consulting">ìƒë‹´ ìš”ì²­ í•˜ê¸°</button>
                    <button class="custom-control custom-control-inline custom-checkbox" data-bs-toggle="modal"
                    data-bs-target="#my_consulting_request" style="margin-right: 20px;">ìš”ì²­ì¤‘ì¸ ìƒë‹´ ë³´ê¸°</button>
                    <button class="custom-control custom-control-inline custom-checkbox" data-bs-toggle="modal"
                    data-bs-target="#request_task">ì—…ë¬´ ìš”ì²­ í•˜ê¸°</button>
                    <button class="custom-control custom-control-inline custom-checkbox" data-bs-toggle="modal"
                    data-bs-target="#my_task_request">ìš”ì²­ì¤‘ì¸ ì—…ë¬´ ë³´ê¸°</button>    
            </div>

        </div>

    </section>
    <section id="work">
        <div class="make_col">
            <div class="label" id="default_title">
                <h1> ì„ ìƒë‹˜ ë¬¸ì˜ í˜„í™© </h1>
            </div>
            <table class="table text-center" id="teacher_question" style="width:100%;">
                <tbody >
                    <thead>
                        <tr class="row">
                            <th class="col-3">ì¢…ë¥˜</th>
                            <th class="col-3">ì„ ìƒë‹˜</th>
                            <th class="col-4">ì œëª©</th>
                            <th class="col-2">ì‘ë‹µ</th>
                        </tr>
                    </thead>
                   
                    {% for q in questions %}
                    <tr class="row">
                        {% if q.category == 0 %}
                        <td class="col-3">ì¼ë°˜ë¬¸ì˜</td>
                        {% elif q.category == 1 %}
                        <td class="col-3">í‡´ì†Œìš”ì²­</td>
                        {% elif q.category == 2 %}
                        <td class="col-3">ì´ë°˜ìš”ì²­</td>
                        {% else %}
                        <td class="col-3">ì·¨ì†Œ/í™˜ë¶ˆ</td>
                        {% endif %}
                        <td class="col-3"> {{q.teacher_id}} </td>
                        <td class="col-4"> {{ q.contents }} </td>
                        <td class="col-2"> <button>âœï¸</button> <button>âŒ</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table> 
        </div>
    </section>
</div>

{% block jspart %}
<script type="text/javascript" src="../static/js/manage.js"></script>
{% endblock %}

{% endautoescape %}
{% endblock %}